import"./main-C-M8-tbW.js";/* empty css             */class e{constructor(e){this.element=e,this.editors=new Map,this.currentTab="html",this.previewFrame=null,this.consoleContainer=null,this.metrics=new Map,this.isFullscreen=!1,this.autoSave=!0,this.debounceTimeout=null,this.init()}init(){this.setupElements(),this.setupEventListeners(),this.setupEditors(),this.setupKeyboardShortcuts(),this.loadSavedCode(),this.updatePreview()}setupElements(){this.tabs=this.element.querySelectorAll(".bsb-code-playground__tab"),this.panels=this.element.querySelectorAll(".bsb-code-playground__panel"),this.previewFrame=this.element.querySelector(".bsb-code-playground__preview"),this.consoleContainer=this.element.querySelector(".bsb-code-playground__console"),this.loadingIndicator=this.element.querySelector(".bsb-code-playground__preview-loading"),this.editors.set("html",this.element.querySelector("#html-editor")),this.editors.set("css",this.element.querySelector("#css-editor")),this.editors.set("js",this.element.querySelector("#js-editor"))}setupEventListeners(){this.tabs.forEach((e=>{e.addEventListener("click",(e=>this.switchTab(e.target.dataset.tab)))})),this.element.addEventListener("click",(e=>{const{action:t}=e.target.dataset;t&&this.handleAction(t)})),this.editors.forEach(((e,t)=>{e.addEventListener("input",(()=>{this.onCodeChange(t)})),e.addEventListener("keydown",(e=>{this.handleEditorKeydown(e,t)}))})),window.addEventListener("beforeunload",(()=>{this.saveCode()}))}setupEditors(){this.editors.forEach(((e,t)=>{e.classList.add(`language-${t}`),e.addEventListener("keydown",(t=>{if("Tab"===t.key){t.preventDefault();const s=e.selectionStart,o=e.selectionEnd;if(t.shiftKey){const t=e.value.lastIndexOf("\n",s-1)+1,o=e.value.substring(t,s);o.startsWith("  ")&&(e.value=e.value.substring(0,t)+o.substring(2)+e.value.substring(s),e.selectionStart=e.selectionEnd=s-2)}else e.value=`${e.value.substring(0,s)}  ${e.value.substring(o)}`,e.selectionStart=e.selectionEnd=s+2}}))}))}setupKeyboardShortcuts(){document.addEventListener("keydown",(e=>{if(this.element.contains(document.activeElement)){if(e.ctrlKey||e.metaKey)switch(e.key){case"Enter":e.preventDefault(),this.updatePreview();break;case"s":e.preventDefault(),this.saveCode(),this.showConsoleMessage("üíæ Code saved!","info");break;case"1":case"2":case"3":{e.preventDefault();const t=parseInt(e.key,10),s=["html","css","js"];s[t-1]&&this.switchTab(s[t-1]);break}}"Escape"===e.key&&this.isFullscreen&&this.toggleFullscreen()}}))}switchTab(e){if(!e||this.currentTab===e)return;this.tabs.forEach((t=>{const s=t.dataset.tab===e;t.classList.toggle("bsb-code-playground__tab--active",s),t.setAttribute("aria-selected",s)})),this.panels.forEach((t=>{const s=t.dataset.panel===e;t.classList.toggle("bsb-code-playground__panel--active",s)})),this.currentTab=e;const t=this.editors.get(e);t&&setTimeout((()=>t.focus()),100)}handleAction(e){switch(e){case"reset":this.resetCode();break;case"fullscreen":this.toggleFullscreen();break;case"share":this.shareCode();break;case"run":case"refresh":this.updatePreview();break;case"new-window":this.openInNewWindow()}}onCodeChange(e){this.updateMetrics(),clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((()=>{this.updatePreview(),this.autoSave&&this.saveCode()}),500)}handleEditorKeydown(e,t){const s=this.editors.get(t),o={"(":")","[":"]","{":"}",'"':'"',"'":"'"};if(o[e.key]){const t=s.selectionStart,n=s.selectionEnd;if(t===n){e.preventDefault();const i=o[e.key];s.value=s.value.substring(0,t)+e.key+i+s.value.substring(n),s.selectionStart=s.selectionEnd=t+1}}}updatePreview(){const e=performance.now();this.showLoading();try{const t=this.editors.get("html").value,s=this.editors.get("css").value,o=this.editors.get("js").value,n=this.generatePreviewDocument(t,s,o),i=this.previewFrame;i.srcdoc=n,i.onload=()=>{const t=performance.now(),s=Math.round(t-e);this.hideLoading(),this.updateMetric("render",`${s}ms`),this.showConsoleMessage(`‚úÖ Preview updated in ${s}ms`,"info"),this.setupConsoleCapture(i)},i.onerror=e=>{this.hideLoading(),this.showConsoleMessage(`‚ùå Preview error: ${e.message}`,"error")}}catch(t){this.hideLoading(),this.showConsoleMessage(`‚ùå Preview error: ${t.message}`,"error")}}generatePreviewDocument(e,t,s){return`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>BSB Code Preview</title>\n  <style>\n    body {\n      margin: 16px;\n      font-family: system-ui, -apple-system, sans-serif;\n      line-height: 1.6;\n    }\n    ${t}\n  </style>\n</head>\n<body>\n  ${e}\n  <script>\n    // Console capture setup\n    const originalConsole = {\n      log: console.log,\n      warn: console.warn,\n      error: console.error\n    };\n    \n    window.capturedLogs = [];\n    \n    ['log', 'warn', 'error'].forEach(method => {\n      console[method] = function(...args) {\n        window.capturedLogs.push({\n          type: method,\n          message: args.join(' '),\n          timestamp: Date.now()\n        });\n        originalConsole[method].apply(console, args);\n        \n        // Send to parent\n        if (window.parent && window.parent.postMessage) {\n          window.parent.postMessage({\n            type: 'console',\n            method: method,\n            message: args.join(' ')\n          }, '*');\n        }\n      };\n    });\n    \n    // Error handling\n    window.addEventListener('error', (e) => {\n      const message = \`\${e.filename}:\${e.lineno} - \${e.message}\`;\n      console.error(message);\n    });\n    \n    try {\n      ${s}\n    } catch (error) {\n      console.error('JavaScript Error:', error.message);\n    }\n  <\/script>\n</body>\n</html>`.trim()}setupConsoleCapture(e){const t=t=>{if(t.source===e.contentWindow&&"console"===t.data.type){const{method:e,message:s}=t.data,o="log"===e?"info":e;this.showConsoleMessage(s,o)}};window.addEventListener("message",t),this.consoleMessageHandler&&window.removeEventListener("message",this.consoleMessageHandler),this.consoleMessageHandler=t}showConsoleMessage(e,t="info"){const s=document.createElement("div");s.className=`bsb-code-playground__console-message bsb-code-playground__console-message--${t}`;const o=(new Date).toLocaleTimeString();s.innerHTML=`\n      <span class="bsb-code-playground__console-icon">${{info:"‚ÑπÔ∏è",warn:"‚ö†Ô∏è",error:"‚ùå"}[t]||"‚ÑπÔ∏è"}</span>\n      <span class="bsb-code-playground__console-text">${e}</span>\n      <span class="bsb-code-playground__console-time">${o}</span>\n    `,this.consoleContainer.appendChild(s),this.consoleContainer.scrollTop=this.consoleContainer.scrollHeight;const n=this.consoleContainer.children;n.length>50&&this.consoleContainer.removeChild(n[0])}updateMetrics(){let e=0,t=0;this.editors.forEach((s=>{const o=s.value;e+=o.split("\n").length,t+=new Blob([o]).size})),this.updateMetric("lines",e.toString()),this.updateMetric("size",this.formatBytes(t))}updateMetric(e,t){const s=this.element.querySelector(`[data-metric="${e}"]`);s&&(s.textContent=t)}formatBytes(e){if(0===e)return"0b";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+["b","kb","mb"][t]}showLoading(){this.loadingIndicator&&this.loadingIndicator.classList.add("bsb-code-playground__preview-loading--visible")}hideLoading(){this.loadingIndicator&&this.loadingIndicator.classList.remove("bsb-code-playground__preview-loading--visible")}resetCode(){confirm("Are you sure you want to reset all code? This cannot be undone.")&&(this.editors.forEach((e=>{const t=e.defaultValue||e.getAttribute("data-original");t&&(e.value=t)})),this.updatePreview(),this.updateMetrics(),this.showConsoleMessage("üîÑ Code reset to defaults","info"))}toggleFullscreen(){this.isFullscreen=!this.isFullscreen,this.element.classList.toggle("bsb-code-playground--fullscreen",this.isFullscreen);const e=this.element.querySelector('[data-action="fullscreen"]');e&&(e.textContent=this.isFullscreen?"üóó Exit Fullscreen":"üñ•Ô∏è Fullscreen"),this.isFullscreen?document.body.style.overflow="hidden":document.body.style.overflow=""}shareCode(){const e={html:this.editors.get("html").value,css:this.editors.get("css").value,js:this.editors.get("js").value},t=btoa(JSON.stringify(e)),s=`${window.location.origin}${window.location.pathname}?code=${t}`;navigator.share?navigator.share({title:"BSB Code Playground",text:"Check out my code!",url:s}):navigator.clipboard.writeText(s).then((()=>{this.showConsoleMessage("üì§ Share link copied to clipboard!","info")})).catch((()=>{this.showConsoleMessage("‚ùå Could not copy share link","error")}))}openInNewWindow(){const e=this.editors.get("html").value,t=this.editors.get("css").value,s=this.editors.get("js").value,o=this.generatePreviewDocument(e,t,s),n=window.open("","_blank");n?(n.document.write(o),n.document.close()):this.showConsoleMessage("‚ùå Could not open new window - popup blocked?","error")}saveCode(){if(!this.autoSave)return;const e={html:this.editors.get("html").value,css:this.editors.get("css").value,js:this.editors.get("js").value,timestamp:Date.now()};try{localStorage.setItem("bsb-playground-code",JSON.stringify(e))}catch(t){}}loadSavedCode(){const e=new URLSearchParams(window.location.search).get("code");if(e)try{const t=JSON.parse(atob(e));return this.editors.get("html").value=t.html||"",this.editors.get("css").value=t.css||"",this.editors.get("js").value=t.js||"",void this.showConsoleMessage("üì§ Loaded shared code!","info")}catch(t){}try{const e=localStorage.getItem("bsb-playground-code");if(e){const t=JSON.parse(e);Date.now()-t.timestamp<864e5&&(this.editors.get("html").value=t.html||"",this.editors.get("css").value=t.css||"",this.editors.get("js").value=t.js||"",this.showConsoleMessage("üíæ Restored previous session","info"))}}catch(t){}}}function t(){document.querySelectorAll('[data-bsb-component="code-playground"]').forEach((t=>{new e(t)}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),window.BSBCodePlayground=e;
