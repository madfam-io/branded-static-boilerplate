#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# =============================================================================
# POST-MERGE HOOK - Rebuild After Pull
# =============================================================================
# 
# This hook runs after a successful merge (including git pull) to ensure:
# 1. Dependencies are up-to-date
# 2. The static build reflects the latest changes
# 
# ğŸ¯ Purpose:
# - Keeps your local environment synchronized
# - Prevents outdated builds after pulling changes
# - Ensures consistency across team members
# =============================================================================

echo "ğŸ”„ Post-merge: Updating your environment..."

# Check if package.json was modified
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD | grep -q "package.json"; then
    echo "ğŸ“¦ Package.json changed, installing dependencies..."
    npm install || {
        echo "âš ï¸  Warning: npm install failed"
        echo "   Please run 'npm install' manually"
    }
fi

# Check if any source files were modified
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD | grep -q "^src/"; then
    echo "ğŸ”¨ Source files changed, rebuilding..."
    npm run build || {
        echo "âš ï¸  Warning: Build failed"
        echo "   Please run 'npm run build' manually"
    }
else
    echo "â„¹ï¸  No source files changed, skipping build"
fi

echo "âœ… Post-merge complete!"